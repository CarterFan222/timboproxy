<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>TimboProxy</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">

  <div class="text-center py-8">
    <h1 class="text-3xl font-bold">TimboProxy</h1>
    <p class="text-gray-400">Your embedded web browser</p>
  </div>

  <div class="flex justify-center gap-2 px-4">
    <input id="urlInput" type="text" value="https://" placeholder="Enter a URL"
      class="w-full max-w-md px-4 py-2 rounded bg-gray-800 text-white placeholder-gray-400" />
    <button id="goButton" class="bg-blue-600 px-4 py-2 rounded hover:bg-blue-700">Go</button>
  </div>

  <iframe id="browserFrame" class="mt-6 w-full h-[80vh] bg-white" srcdoc="
    <div style='padding:20px;text-align:center;font-family:sans-serif'>
      <h2>Welcome to TimboProxy</h2>
      <p>Type a URL above and press Go.</p>
    </div>
  "></iframe>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const goBtn = document.getElementById("goButton");
      const urlInput = document.getElementById("urlInput");
      const iframe = document.getElementById("browserFrame");

      async function loadSite() {
        const url = urlInput.value.trim();
        console.log("Loading:", url);

        if (!url.startsWith("http://") && !url.startsWith("https://")) {
          alert("Please enter a full URL including https://");
          return;
        }

        iframe.srcdoc = `<p style='padding:20px;'>Loading ${url}...</p>`;

        try {
          const res = await fetch(`https://timboproxybackend.vercel.app/proxy?url=${encodeURIComponent(url)}`);
          const html = await res.text();
          iframe.srcdoc = html;
        } catch (e) {
          console.error(e);
          iframe.srcdoc = `<p style='padding:20px;color:red;'>Failed to load ${url}</p>`;
        }
      }

      goBtn.addEventListener("click", loadSite);
      urlInput.addEventListener("keydown", function (e) {
        if (e.key === "Enter") loadSite();
      });
    });
  </script>
</body>
</html>
